<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Análise de Vendas</title> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <!-- Firebase v8 -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    
    <style>
        /* --- Configurações Globais --- */
        :root {
            --color-primary: #b95c21;
            --color-secondary: #007bff;
            --color-danger: #d9534f;
            --color-warning: #f5a623;
            --color-success: #28a745;
            --color-text-dark: #333;
            --color-text-light: #555;
            --color-text-header: #777;
            --color-text-timestamp: #888;
            --color-border: #e9e9e9;
            --color-bg-page: #ffffff;
            --color-bg-light: #f9f9f9;
            --color-bg-table-header: #f1f1f1;
            --color-success-bg: #e9f7ec;
            --color-card-title-bg: rgba(255, 255, 255, 0.6);
            --color-card-price-bg: #8c4a28;
            /* Cores específicas do Gráfico */
            --color-bar-green: #28a745; 
            --color-bar-blue: #007bff;  
            --color-bar-red: #b32a31;   
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--color-bg-page);
            color: var(--color-text-dark);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* --- Header (Barra Laranja) --- */
        .top-bar {
            background-color: var(--color-primary);
            color: white;
            padding: 10px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }
        .user-info { display: flex; align-items: center; gap: 12px; }
        .user-info .user-avatar { font-size: 36px; opacity: 0.9; }
        .user-info div { display: flex; flex-direction: column; font-size: 14px; }
        .user-info .user-name { font-weight: 600; }
        .user-info .user-role { font-size: 12px; opacity: 0.8; }
        
        /* --- NAVBAR COM ESPAÇAMENTO IGUAL AOS OUTROS CÓDIGOS --- */
        .header-nav { 
            display: flex; 
            align-items: center; 
            gap: 28px; /* MESMO ESPAÇAMENTO DOS OUTROS CÓDIGOS */
        }
        .header-nav a {
            color: white;
            text-decoration: none;
            opacity: 0.8; 
            padding: 10px 15px; /* MESMO ESPAÇAMENTO DOS OUTROS CÓDIGOS */
            border-radius: 6px; 
            transition: opacity 0.2s, background-color 0.2s;
        }
        .header-nav a:hover {
            opacity: 1; 
            background-color: rgba(255, 255, 255, 0.1); 
        }
        .header-nav i { 
            font-size: 20px; 
            cursor: pointer; 
            display: block; 
        }
        /* --- Layout Principal --- */
        .page-container {
            max-width: 1100px;
            width: 95%;
            margin: 32px auto;
            padding: 24px;
            flex-grow: 1;
        }
        .page-header {
            position: relative;
            text-align: center;
            margin-bottom: 32px;
            padding-bottom: 16px;
        }
        .page-header h2 {
            font-size: 20px;
            font-weight: 400;
            color: var(--color-text-header);
            letter-spacing: 0.5px;
            display: inline-block;
            padding-bottom: 8px;
            border-bottom: 1px solid #ccc;
        }
        .page-header .timestamp {
            position: absolute;
            top: 0;
            right: 0;
            font-size: 16px;
            color: var(--color-text-light);
            font-weight: 500;
        }
        .section-title { font-size: 18px; font-weight: 500; color: var(--color-text-header); margin-bottom: 16px; border-bottom: 1px solid var(--color-border); padding-bottom: 8px; }

        /* --- KPIs (Cards de Resumo) --- */
        .kpi-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 32px; }
        .kpi-card { background-color: var(--color-bg-light); border: 1px solid var(--color-border); border-radius: 8px; padding: 20px; display: flex; align-items: center; gap: 16px; }
        .kpi-card .icon { font-size: 28px; width: 40px; text-align: center; }
        .kpi-card .icon.success { color: var(--color-success); }
        .kpi-card .icon.warning { color: var(--color-warning); }
        .kpi-card .icon.danger { color: var(--color-danger); }
        .kpi-card .icon.info, .kpi-card .icon.total { color: var(--color-primary); }
        .kpi-card-info .kpi-value { font-size: 24px; font-weight: 600; color: var(--color-text-dark); display: block; margin-bottom: 4px; }
        .kpi-card-info .kpi-title { font-size: 13px; color: var(--color-text-light); font-weight: 500; text-transform: uppercase; }

        /* --- Gráfico (Vendas) --- */
        .chart-section { display: flex; flex-direction: column; align-items: center; gap: 30px; margin-bottom: 40px; }
        .bar-chart-container { position: relative; width: 100%; max-width: 700px; height: 400px; padding-left: 50px; }
        .y-axis { position: absolute; left: 0; top: 0; width: 100%; height: 100%; margin-left: 50px; z-index: 1; }
        .y-axis::before { content: ''; position: absolute; left: 0; top: 0; width: 1px; height: calc(100% - 40px); background-color: var(--color-text-dark); }
        .y-axis::after { content: ''; position: absolute; left: 0; bottom: 40px; width: calc(100% - 50px); height: 1px; background-color: var(--color-text-dark); }
        .y-axis-label { position: absolute; left: -40px; font-size: 13px; color: var(--color-text-light); text-align: right; width: 35px; }
        .grid-line { position: absolute; width: calc(100% - 50px); height: 1px; background-color: var(--color-border); z-index: 0; left: 0; }
        .y-axis-label[data-value="0"] { bottom: 40px; transform: translateY(50%); left: -45px; }
        .y-axis-label[data-value="50"] { bottom: calc(40px + (360px * 0.1)); transform: translateY(50%); }
        .grid-line[data-value="50"] { bottom: calc(40px + (360px * 0.1)); }
        .y-axis-label[data-value="100"] { bottom: calc(40px + (360px * 0.2)); transform: translateY(50%); }
        .grid-line[data-value="100"] { bottom: calc(40px + (360px * 0.2)); }
        .y-axis-label[data-value="150"] { bottom: calc(40px + (360px * 0.3)); transform: translateY(50%); }
        .grid-line[data-value="150"] { bottom: calc(40px + (360px * 0.3)); }
        .y-axis-label[data-value="200"] { bottom: calc(40px + (360px * 0.4)); transform: translateY(50%); }
        .grid-line[data-value="200"] { bottom: calc(40px + (360px * 0.4)); }
        .y-axis-label[data-value="250"] { bottom: calc(40px + (360px * 0.5)); transform: translateY(50%); }
        .grid-line[data-value="250"] { bottom: calc(40px + (360px * 0.5)); }
        .y-axis-label[data-value="300"] { bottom: calc(40px + (360px * 0.6)); transform: translateY(50%); }
        .grid-line[data-value="300"] { bottom: calc(40px + (360px * 0.6)); }
        .y-axis-label[data-value="350"] { bottom: calc(40px + (360px * 0.7)); transform: translateY(50%); }
        .grid-line[data-value="350"] { bottom: calc(40px + (360px * 0.7)); }
        .y-axis-label[data-value="400"] { bottom: calc(40px + (360px * 0.8)); transform: translateY(50%); }
        .grid-line[data-value="400"] { bottom: calc(40px + (360px * 0.8)); }
        .y-axis-label[data-value="450"] { bottom: calc(40px + (360px * 0.9)); transform: translateY(50%); }
        .grid-line[data-value="450"] { bottom: calc(40px + (360px * 0.9)); }
        .y-axis-label[data-value="500+"] { bottom: calc(40px + 360px); transform: translateY(50%); }
        .grid-line[data-value="500"] { bottom: calc(40px + 360px); }

        .chart-scroll-wrapper { position: absolute; left: 50px; top: 0; width: calc(100% - 50px); height: 100%; overflow-x: auto; overflow-y: hidden; z-index: 5; }
        .bars { position: relative; width: 1000px; height: 100%; display: flex; align-items: flex-end; justify-content: space-around; padding: 0 10px; padding-bottom: 40px; }
        .bar-item { width: 10%; background-color: lightgray; border-top-left-radius: 3px; border-top-right-radius: 3px; transition: height 0.5s ease-out; position: relative; }
        .bar-item.green { background-color: var(--color-bar-green); }
        .bar-item.blue { background-color: var(--color-bar-blue); }
        .bar-item.red { background-color: var(--color-bar-red); }
        .bar-label { position: absolute; bottom: -30px; left: 50%; transform: translateX(-50%); font-size: 16px; font-weight: 600; color: var(--color-text-dark); white-space: nowrap; }
        .chart-legend { display: flex; flex-wrap: wrap; justify-content: center; gap: 24px; width: 100%; }
        .legend-item { display: flex; align-items: center; gap: 10px; font-size: 14px; color: var(--color-text-dark); font-weight: 500; }
        .legend-color { width: 20px; height: 20px; border-radius: 2px; }
        .legend-color.green { background-color: var(--color-bar-green); }
        .legend-color.blue { background-color: var(--color-bar-blue); }
        .legend-color.red { background-color: var(--color-bar-red); }

        /* --- Tabela de Dados --- */
        .table-wrapper { width: 100%; overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; background-color: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.05); border-radius: 8px; overflow: hidden; border: 1px solid var(--color-border); }
        th, td { padding: 14px 18px; text-align: left; vertical-align: middle; border-bottom: 1px solid var(--color-border); }
        thead th { background-color: var(--color-bg-table-header); font-size: 13px; color: var(--color-text-light); text-transform: uppercase; white-space: nowrap; }
        tbody tr:hover { background-color: #fcfcfc; }
        tbody tr:last-child td { border-bottom: none; }
        .status-badge { display: inline-flex; align-items: center; gap: 6px; padding: 5px 12px; border-radius: 15px; font-size: 13px; font-weight: 600; text-transform: uppercase; }
        .status-badge.status-green { background-color: var(--color-success-bg); color: var(--color-success); }
        .status-badge.status-blue { background-color: #e6f2ff; color: var(--color-secondary); }
        .status-badge.status-red { background-color: #fdecea; color: var(--color-danger); }
        
        /* --- Loading --- */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--color-text-light);
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--color-primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* --- Responsividade --- */
        @media (max-width: 768px) {
            .top-bar { flex-direction: column; gap: 16px; padding: 16px; }
            .header-nav { gap: 20px; flex-wrap: wrap; justify-content: center; }
            .page-header { text-align: left; display: flex; flex-direction: column; align-items: flex-start; gap: 8px; }
            .page-header h2 { font-size: 18px; }
            .page-header .timestamp { position: static; font-size: 14px; }
            .page-container { margin-top: 24px; padding: 16px; }
            .kpi-card-info .kpi-value { font-size: 20px; }
            .bar-chart-container { max-width: 100%; height: 300px; padding-left: 40px; padding-bottom: 30px; }
            .y-axis::before { height: calc(100% - 30px); }
            .y-axis::after { bottom: 30px; }
            .y-axis-label { left: -35px; font-size: 12px; }
            .y-axis-label[data-value="0"] { left: -40px; bottom: 30px; }
            /* Ajustes para 270px de área de gráfico */
            .y-axis-label[data-value="50"] { bottom: calc(30px + (270px * 0.1)); }
            .grid-line[data-value="50"] { bottom: calc(30px + (270px * 0.1)); }
            .y-axis-label[data-value="100"] { bottom: calc(30px + (270px * 0.2)); }
            .grid-line[data-value="100"] { bottom: calc(30px + (270px * 0.2)); }
            .y-axis-label[data-value="150"] { bottom: calc(30px + (270px * 0.3)); }
            .grid-line[data-value="150"] { bottom: calc(30px + (270px * 0.3)); }
            .y-axis-label[data-value="200"] { bottom: calc(30px + (270px * 0.4)); }
            .grid-line[data-value="200"] { bottom: calc(30px + (270px * 0.4)); }
            .y-axis-label[data-value="250"] { bottom: calc(30px + (270px * 0.5)); }
            .grid-line[data-value="250"] { bottom: calc(30px + (270px * 0.5)); }
            .y-axis-label[data-value="300"] { bottom: calc(30px + (270px * 0.6)); }
            .grid-line[data-value="300"] { bottom: calc(30px + (270px * 0.6)); }
            .y-axis-label[data-value="350"] { bottom: calc(30px + (270px * 0.7)); }
            .grid-line[data-value="350"] { bottom: calc(30px + (270px * 0.7)); }
            .y-axis-label[data-value="400"] { bottom: calc(30px + (270px * 0.8)); }
            .grid-line[data-value="400"] { bottom: calc(30px + (270px * 0.8)); }
            .y-axis-label[data-value="450"] { bottom: calc(30px + (270px * 0.9)); }
            .grid-line[data-value="450"] { bottom: calc(30px + (270px * 0.9)); }
            .y-axis-label[data-value="500+"] { bottom: calc(30px + 270px); }
            .grid-line[data-value="500"] { bottom: calc(30px + 270px); }
            
            .chart-scroll-wrapper { left: 40px; width: calc(100% - 40px); height: 100%; }
            .bars { width: 800px; padding-bottom: 30px; }
            .bar-item { width: 10%; }
            .bar-label { font-size: 13px; bottom: -25px; }
            .chart-legend { gap: 16px; }
            .legend-item { font-size: 13px; gap: 6px; }
            .legend-color { width: 14px; height: 14px; }
        }
    </style>
</head>
<body> 
    
    <header class="top-bar">
        <div class="user-info">
            <i class="fa-solid fa-user-circle user-avatar"></i>
            <div>
                <span class="user-name">Felipe</span>
                <span class="user-role">administração da plataforma</span>
            </div>
        </div>
        <nav class="header-nav">
            <a href="Adm_status.html"><i class="fa-solid fa-list-check" title="Status"></i></a>
            <a href="Adm_Ped.html"><i class="fa-solid fa-truck" title="Entregas"></i></a>
            <a href="Adm_anal.html" style="background-color: rgba(255,255,255,0.2);"><i class="fa-solid fa-chart-line" title="Vendas"></i></a>
            <a href="Adam_estoq.html"><i class="fa-solid fa-box" title="Estoque"></i></a>
            <a href="Adm_agen.html"><i class="fa-solid fa-calendar-days" title="Agenda"></i></a>
            <a href="Adm_Func.html"><i class="fa-solid fa-user" title="Funcionários"></i></a>
            <a href="adm_adCard.html"><i class="fa-solid fa-utensils" title="Cardápio"></i></a>
            <a href="index.html"><i class="fa-solid fa-arrow-right-from-bracket" title="Sair"></i></a>
        </nav>
    </header>

    <main class="page-container">
        <header class="page-header">
            <h2>ANALISE MENSAL DE VENDAS</h2>
            <span class="timestamp" id="current-timestamp"></span>
        </header>

        <section class="kpi-container">
            <div class="kpi-card">
                <i class="fa-solid fa-cash-register icon total"></i>
                <div class="kpi-card-info">
                    <span class="kpi-value" id="kpi-total-units">0</span>
                    <span class="kpi-title">Faturamento Total</span>
                </div>
            </div>
            <div class="kpi-card">
                <i class="fa-solid fa-calculator icon info"></i>
                <div class="kpi-card-info">
                    <span class="kpi-value" id="kpi-avg-units">R$ 0</span>
                    <span class="kpi-title">Média Mensal</span>
                </div>
            </div>
            <div class="kpi-card">
                <i class="fa-solid fa-arrow-trend-up icon success"></i>
                <div class="kpi-card-info">
                    <span class="kpi-value" id="kpi-best-month">--</span>
                    <span class="kpi-title">Melhor Mês</span>
                </div>
            </div>
            <div class="kpi-card">
                <i class="fa-solid fa-arrow-trend-down icon danger"></i>
                <div class="kpi-card-info">
                    <span class="kpi-value" id="kpi-worst-month">--</span>
                    <span class="kpi-title">Pior Mês</span>
                </div>
            </div>
        </section>

        <section class="chart-section">
            <div class="loading" id="chart-loading">
                <div class="spinner"></div>
                <p>Calculando vendas mensais...</p>
            </div>

            <div class="bar-chart-container" id="chart-container" style="display: none;">
                <div class="y-axis">
                    <span class="y-axis-label" data-value="0">R$ 0</span>
                    <span class="y-axis-label" data-value="50">R$ 50</span><div class="grid-line" data-value="50"></div>
                    <span class="y-axis-label" data-value="100">R$ 100</span><div class="grid-line" data-value="100"></div>
                    <span class="y-axis-label" data-value="150">R$ 150</span><div class="grid-line" data-value="150"></div>
                    <span class="y-axis-label" data-value="200">R$ 200</span><div class="grid-line" data-value="200"></div>
                    <span class="y-axis-label" data-value="250">R$ 250</span><div class="grid-line" data-value="250"></div>
                    <span class="y-axis-label" data-value="300">R$ 300</span><div class="grid-line" data-value="300"></div>
                    <span class="y-axis-label" data-value="350">R$ 350</span><div class="grid-line" data-value="350"></div>
                    <span class="y-axis-label" data-value="400">R$ 400</span><div class="grid-line" data-value="400"></div>
                    <span class="y-axis-label" data-value="450">R$ 450</span><div class="grid-line" data-value="450"></div>
                    <span class="y-axis-label" data-value="500+">R$ 500+</span><div class="grid-line" data-value="500"></div>
                </div>

                <div class="chart-scroll-wrapper">
                    <div class="bars" id="chart-bars">
                        <!-- Barras serão geradas dinamicamente -->
                    </div>
                </div>
            </div>

            <div class="chart-legend" id="chart-legend" style="display: none;">
                <div class="legend-item">
                    <span class="legend-color green"></span>
                    <span>VENDAS ACIMA DA MÉDIA</span>
                </div>
                <div class="legend-item">
                    <span class="legend-color blue"></span>
                    <span>VENDAS NORMAIS</span>
                </div>
                <div class="legend-item">
                    <span class="legend-color red"></span>
                    <span>VENDAS ABAIXO DA MÉDIA</span>
                </div>
            </div>
        </section>
        
        <section class="data-table-container">
            <h2 class="section-title">Dados Detalhados</h2>
            <div class="loading" id="table-loading">
                <div class="spinner"></div>
                <p>Carregando dados...</p>
            </div>
            <div class="table-wrapper" id="table-container" style="display: none;">
                <table>
                    <thead>
                        <tr>
                            <th>Mês/Ano</th>
                            <th>Total de Vendas</th>
                            <th>Nº de Pedidos</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="data-table-body">
                        <!-- Dados serão preenchidos dinamicamente -->
                    </tbody>
                </table>
            </div>
        </section>
    </main>

    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCn694_Aswhv1Fb2dn7pnWox4JVW66Xy2k",
            authDomain: "salgaderia-mestre.firebaseapp.com",
            projectId: "salgaderia-mestre",
            storageBucket: "salgaderia-mestre.firebasestorage.app",
            messagingSenderId: "280285587483",
            appId: "1:280285587483:web:0b36fab366f2e0f2b8b0be",
            measurementId: "G-1QSMWQ65ZZ"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        document.addEventListener('DOMContentLoaded', function() {
            updateTimestamp();
            setInterval(updateTimestamp, 1000);
            
            loadSalesData();
        });

        function updateTimestamp() {
            const now = new Date();
            const date = now.toLocaleDateString('pt-BR');
            const time = now.toLocaleTimeString('pt-BR');
            document.getElementById('current-timestamp').textContent = `${date} ${time}`;
        }

        async function loadSalesData() {
            try {
                // Buscar todos os pedidos entregues
                const querySnapshot = await db.collection("pedidos")
                    .where("status", "==", "entregue")
                    .get();

                const monthlySales = calculateMonthlySales(querySnapshot);
                renderDashboard(monthlySales);
                
            } catch (error) {
                console.error("Erro ao carregar dados de vendas:", error);
                document.getElementById('chart-loading').innerHTML = '<p style="color: red;">Erro ao carregar dados de vendas</p>';
                document.getElementById('table-loading').innerHTML = '<p style="color: red;">Erro ao carregar dados</p>';
            }
        }

        function calculateMonthlySales(querySnapshot) {
            const monthlyData = {};
            const monthNames = [
                'Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun',
                'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'
            ];

            querySnapshot.forEach((doc) => {
                const order = doc.data();
                if (order.createdAt && order.total) {
                    const orderDate = new Date(order.createdAt.seconds * 1000);
                    const monthYear = `${monthNames[orderDate.getMonth()]}/${orderDate.getFullYear()}`;
                    
                    if (!monthlyData[monthYear]) {
                        monthlyData[monthYear] = {
                            total: 0,
                            count: 0,
                            month: monthNames[orderDate.getMonth()],
                            year: orderDate.getFullYear(),
                            fullDate: orderDate
                        };
                    }
                    
                    monthlyData[monthYear].total += order.total;
                    monthlyData[monthYear].count += 1;
                }
            });

            // Converter para array e ordenar por data
            return Object.values(monthlyData)
                .sort((a, b) => a.fullDate - b.fullDate)
                .map(item => ({
                    mes: `${item.month}/${item.year}`,
                    valor: item.total,
                    pedidos: item.count,
                    fullDate: item.fullDate
                }));
        }

        function renderDashboard(vendasData) {
            // Esconder loading e mostrar conteúdo
            document.getElementById('chart-loading').style.display = 'none';
            document.getElementById('table-loading').style.display = 'none';
            document.getElementById('chart-container').style.display = 'block';
            document.getElementById('chart-legend').style.display = 'flex';
            document.getElementById('table-container').style.display = 'block';

            const barsContainer = document.getElementById('chart-bars');
            const tableBody = document.getElementById('data-table-body');
            
            if (vendasData.length === 0) {
                barsContainer.innerHTML = '<span style="color: var(--color-text-light); padding: 20px;">Nenhum dado de venda encontrado.</span>';
                tableBody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: var(--color-text-light);">Nenhum dado encontrado.</td></tr>';
                return;
            }

            // Calcular média para determinar cores
            const totalVendas = vendasData.reduce((sum, item) => sum + item.valor, 0);
            const mediaMensal = totalVendas / vendasData.length;

            // Encontrar melhor e pior mês
            const melhorMes = vendasData.reduce((best, current) => 
                current.valor > best.valor ? current : best, vendasData[0]);
            const piorMes = vendasData.reduce((worst, current) => 
                current.valor < worst.valor ? current : worst, vendasData[0]);

            // Atualizar KPIs
            document.getElementById('kpi-total-units').textContent = `R$ ${totalVendas.toFixed(2)}`;
            document.getElementById('kpi-avg-units').textContent = `R$ ${mediaMensal.toFixed(2)}`;
            document.getElementById('kpi-best-month').textContent = `${melhorMes.mes} (R$ ${melhorMes.valor.toFixed(2)})`;
            document.getElementById('kpi-worst-month').textContent = `${piorMes.mes} (R$ ${piorMes.valor.toFixed(2)})`;

            // Configurar gráfico
            const maxValue = Math.max(...vendasData.map(item => item.valor), 500);
            barsContainer.style.width = `${vendasData.length * 120}px`;

            // Renderizar barras do gráfico
            barsContainer.innerHTML = '';
            vendasData.forEach(item => {
                const barHeightPercentage = Math.min((item.valor / maxValue) * 100, 100);
                
                let colorClass = 'blue'; // Normal
                let statusTexto = 'Normal';
                
                if (item.valor > mediaMensal * 1.1) {
                    colorClass = 'green';
                    statusTexto = 'Acima';
                } else if (item.valor < mediaMensal * 0.9) {
                    colorClass = 'red';
                    statusTexto = 'Abaixo';
                }

                const barItem = document.createElement('div');
                barItem.className = `bar-item ${colorClass}`;
                barItem.style.height = `${barHeightPercentage}%`;
                barItem.innerHTML = `
                    <span class="bar-label">${item.mes}</span>
                    <div style="position: absolute; top: -25px; left: 50%; transform: translateX(-50%); font-size: 12px; font-weight: 600; color: var(--color-text-dark);">
                        R$ ${item.valor.toFixed(2)}
                    </div>
                `;
                barsContainer.appendChild(barItem);

                // Adicionar tooltip
                barItem.title = `${item.mes}: R$ ${item.valor.toFixed(2)} (${item.pedidos} pedidos)`;
            });

            // Renderizar tabela
            tableBody.innerHTML = '';
            vendasData.forEach(item => {
                let colorClass = 'blue';
                let statusTexto = 'Normal';
                
                if (item.valor > mediaMensal * 1.1) {
                    colorClass = 'green';
                    statusTexto = 'Acima da Média';
                } else if (item.valor < mediaMensal * 0.9) {
                    colorClass = 'red';
                    statusTexto = 'Abaixo da Média';
                }

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${item.mes}</strong></td>
                    <td>R$ ${item.valor.toFixed(2)}</td>
                    <td>${item.pedidos}</td>
                    <td><span class="status-badge status-${colorClass}">${statusTexto}</span></td>
                `;
                tableBody.appendChild(row);
            });
        }
    </script>
</body>
</html>